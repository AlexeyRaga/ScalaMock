<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="RSS feed for this page"/>

    <title>ScalaMock - User Guide - Advanced topics</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/assets/css/style.css" rel="stylesheet">
    <link href="/assets/css/highligh-js-styles/default.css" rel="stylesheet" >
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="/assets/js/modernizr.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-56676479-1', 'auto');
      ga('send', 'pageview');
   </script>
</head>


    <body>
        <!-- Fixed navbar -->
<div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">ScalaMock</a>
    </div>
    <div class="navbar-collapse collapse navbar-right">
      <ul class="nav navbar-nav">
        <li ><a href="/">Home</a></li>
        <li ><a href="/news/">News</a></li>
        <li ><a href="/quick-start/">Quick Start</a></li>
        <li class="active"><a href="/user-guide/">User Guide</a></li>
        <li ><a href="/roadmap/">Roadmap</a></li>
        <li ><a href="/feedback/">Feedback</a></li>
        <li><a href="http://github.com/paulbutcher/scalamock">Github</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>


            <div id="blue">
    <div class="container">
        <div class="row">
            <h3>User Guide - Advanced topics</h3>
        </div><!-- /row -->
    </div> <!-- /container -->
</div><!-- /blue -->
    

<div class="container mb" id="main-content">
    <div class="row">

        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 col-lg-push-8 col-md-push-8" id="sidebar">
    
    

    

    <h4><a href="/user-guide/">User Guide index</a></h4>
    <div class="hline"></div>


    <ul class="page-index">
    
        
            <li> <a href="/user-guide/installation/">Installation </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/integration/">Integration with testing frameworks </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/features/">Features </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/mocking_style/">Choosing your mocking style </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/matching/">Argument matching </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/ordering/">Ordering </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/sharing-scalatest/">Sharing mocks and expectations in ScalaTest </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/sharing-specs2/">Sharing mocks and expectations in Specs2 </a>
            
            </li>
        
    
        
            <li> <a href="/user-guide/advanced_topics/">Advanced topics </a>
            
                <ul><li class="toc_level-1 toc_section-1"><a href="#mocking-overloaded-curried-and-polymorphic-methods"><span class="toctext">Mocking overloaded, curried and polymorphic methods</span></a><ul><li class="toc_level-2 toc_section-2"><a href="#example-1---overloaded-methods"><span class="toctext">Example 1 - Overloaded methods</span></a></li><li class="toc_level-2 toc_section-3"><a href="#example-2---polymorphic-methods"><span class="toctext">Example 2 - Polymorphic methods</span></a></li><li class="toc_level-2 toc_section-4"><a href="#example-3---curried-methods"><span class="toctext">Example 3 - Curried methods</span></a></li><li class="toc_level-2 toc_section-5"><a href="#example-4---methods-with-implicit-parameters"><span class="toctext">Example 4 - Methods with implicit parameters</span></a></li><li class="toc_level-2 toc_section-6"><a href="#example-5---repeated-parameters"><span class="toctext">Example 5 - Repeated parameters</span></a></li></ul></li><li class="toc_level-1 toc_section-7"><a href="#returning-values-oncall"><span class="toctext">Returning values (onCall)</span></a></li><li class="toc_level-1 toc_section-8"><a href="#call-count"><span class="toctext">Call count</span></a></li><li class="toc_level-1 toc_section-9"><a href="#exceptions"><span class="toctext">Exceptions</span></a><ul><li class="toc_level-2 toc_section-10"><a href="#example-1---throws-method"><span class="toctext">Example 1 - throws method</span></a></li><li class="toc_level-2 toc_section-11"><a href="#example-2---throwing-from-oncall-handler"><span class="toctext">Example 2 - throwing from onCall handler</span></a></li></ul></li></ul>
            
            </li>
        
    
        
            <li> <a href="/user-guide/faq/">FAQ </a>
            
            </li>
        
    
        
        
    
    </ul>

    


</div>


        <! -- BLOG POSTS LIST -->
        <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8 col-lg-pull-4 col-md-pull-4">
            <h1 id="advanced-topics">Advanced topics</h1>

<h2 id="mocking-overloaded-curried-and-polymorphic-methods">Mocking overloaded, curried and polymorphic methods</h2>

<p>Overloaded, curried and polymorphic methods can be mocked by specifying either argument types or type parameters.</p>

<h3 id="example-1---overloaded-methods">Example 1 - Overloaded methods</h3>

<pre><code class="language-scala">trait Foo {
  def overloaded(x: Int): String
  def overloaded(x: String): String
  def overloaded[T](x: T): String
}

val fooMock = mock[Foo]

(fooMock.overloaded(_: Int)).expects(10)
(fooMock.overloaded(_: String)).expects("foo")
(fooMock.overloaded[Double] _).expects(1.23)
</code></pre>

<p>You may also prefer to use slightly different syntax:</p>

<pre><code>(fooMock.overloaded _: Int =&gt; String).expects(10)  // or
(fooMock.overloaded _: Int =&gt; String) expects (10) // or
(fooMock.overloaded(_: Int)) expects (10)
</code></pre>

<h3 id="example-2---polymorphic-methods">Example 2 - Polymorphic methods</h3>

<pre><code class="language-scala">trait Foo {
  def polymorphic[T](x: List[T]): String
}

val fooMock = mock[Foo]

(fooMock.polymorphic(_: List[Int])).expects(List(1, 2, 3))            // or
(fooMock.polymorphic[Int] _).expects(List(1, 2, 3))                   // or
(fooMock.polymorphic _ : List[Int] =&gt; String).expects(List(1, 2, 3))
</code></pre>

<h3 id="example-3---curried-methods">Example 3 - Curried methods</h3>

<pre><code class="language-scala">trait Foo {
  def curried(x: Int)(y: Double): String
}

val fooMock = mock[Foo]

(fooMock.curried(_: Int)(_: Double)).expects(10, 1.23)
</code></pre>

<h3 id="example-4---methods-with-implicit-parameters">Example 4 - Methods with implicit parameters</h3>

<p>This case is very similar to curried methods - all you need to do is to help scala compiler know that <code>memcachedMock.get _</code> should be converted to <code>MockFunction2</code>. For example:</p>

<pre><code class="language-scala">class Codec()

trait Memcached {
  def get(key: String)(implicit codec: Codec): Option[Int]
}

val memcachedMock = mock[Memcached]

implicit val codec = new Codec
(memcachedMock.get(_ : String)(_ : Codec)).expects("some_key", *).returning(Some(123))
</code></pre>

<h3 id="example-5---repeated-parameters">Example 5 - Repeated parameters</h3>

<p>Repeated parameters are represented as a Seq. For example, given:</p>

<pre><code class="language-scala">trait Foo {
  def takesRepeatedParameter(x: Int, ys: String*)
}
</code></pre>
<p>you can set an expectation with:</p>

<pre><code class="language-scala">(fooMock.takesRepeatedParameter _).expects(42, Seq("red", "green", "blue"))
</code></pre>

<h2 id="returning-values-oncall">Returning values (onCall)</h2>

<p>By default mocks and stubs return <code>null</code>. You can return predefined value using <code>returning()</code> method (or <code>returns()</code> in case of stubs). When returned value depends on function arguments, you can return the computed value (or throw a computed exception) with <code>onCall()</code>.</p>

<pre><code class="language-scala">trait Foo {
    def increment(a: Int): Int
}

val fooMock = mock[Foo]

(fooMock.increment _) expects(12) returning(13)
fooMock.increment(12) shouldBe 13 

(fooMock.increment _) expects(*) onCall { arg: Int =&gt; arg + 1}
fooMock.increment(100) shouldBe 101

(fooMock.increment _) expects(*) onCall { arg: Int =&gt; throw new RuntimeException("message") }
intercept[RuntimeException] { fooMock.increment(0) }
</code></pre>
<pre><code class="language-scala">val mockIncrement = mockFunction[Int, Int]
mockIncrement expects (*) onCall { arg: Int =&gt; arg + 1 }
mockIncrement(10) shouldBe  11 
</code></pre>

<h2 id="call-count">Call count</h2>

<p>By default, mocks and stubs expect exactly one call. Alternative constraints can be set with <code>repeat()</code>:</p>

<pre><code class="language-scala">mockedFunction.expects(42).returns(42).repeat(3 to 7)
mockedFunction expects (3) repeat 10
</code></pre>

<p>There are various aliases for common expectations and styles:</p>

<pre><code class="language-scala">val mockedFunction1 = mockFunction[Int, String]
val mockedFunction2 = mockFunction[Int, String]
val mockedFunction3 = mockFunction[Int, String]
val mockedFunction4 = mockFunction[Int, String]
val mockedFunction5 = mockFunction[Int, String]

mockedFunction1.expects(1).returning("foo").once
mockedFunction2.expects(2).returning("foo").noMoreThanTwice
mockedFunction3.expects(3).returning("foo").repeated(3).times
mockedFunction4.expects(4).returning("foo").repeat(1 to 2)
mockedFunction5.expects(5).returning("foo").repeat(2)
mockedFunction5.expects(6).returning("foo").never()

mockedFunction1(1)

//mockedFunction2(2) - not called

mockedFunction3(3)
mockedFunction3(3)
mockedFunction3(3)

mockedFunction4(4)
mockedFunction4(4)

mockedFunction5(5)
mockedFunction5(5)

//mockedFunction6(6) - not called
</code></pre>

<p>For a full list, see <code>org.scalamock.CallHandler</code>.</p>

<h2 id="exceptions">Exceptions</h2>

<p>Instead of a return value, mocks and stubs can be instructed to throw. This can be achieved either by throwing exception in <code>onCall</code> handler or by using <code>throws</code> method.</p>

<h3 id="example-1---throws-method">Example 1 - throws method</h3>

<pre><code class="language-scala">trait Foo {
  def increment(a: Int): Int
}

val fooMock = mock[Foo]

(fooMock.increment _) expects (5) throws new RuntimeException("message")

intercept[RuntimeException] { fooMock.increment(5) }
</code></pre>

<h3 id="example-2---throwing-from-oncall-handler">Example 2 - throwing from <code>onCall</code> handler</h3>
<pre><code class="language-scala">(fooMock.increment _) expects(*) onCall { arg: Int =&gt; 
  if (arg == 0) 
      throw new RuntimeException("message") 
  else
      arg + 1
}

intercept[RuntimeException] { fooMock.increment(0) }
</code></pre>

        </div><! --/col-lg-8 -->


    </div><! --/row -->
</div><! --/container -->


        <!--
<div id="footerwrap">
    <div class="container">
        <p>ScalaMock - native Scala mocking framework</p>
    </div>
</div>
-->
<!-- based on https://github.com/st4ple/solid-jekyll -->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    </body>
</html>